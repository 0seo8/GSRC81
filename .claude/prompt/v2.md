# GSRC81 V2 API 시스템 분석 및 현황

## 현재 상황

- V2 API가 **핵심 기능**으로 광범위하게 사용 중
- `courses-data-v2.ts`에서 TypeScript 타입 오류 발생으로 빌드 실패
- V2 제거가 아닌 **타입 오류 수정**이 필요

## V2 API 사용 현황

### 1. 사용자 기능

- **코스 상세 페이지**: `/courses/[id]` → `CourseDetailMapClient` → `TrailMapV2`
- **지도 렌더링**: `TrailMapV2` 컴포넌트에서 V2 데이터 구조 활용

### 2. 관리자 기능

- **코스 관리**: `/admin/courses` 페이지에서 `CourseV2` 타입으로 목록 관리
- **코스 등록**: `GPXUploadForm`을 통한 구조화된 `gpx_data` 필드 저장
- **코스 삭제/수정**: V2 API 기반 CRUD 작업

### 3. 데이터베이스 스키마

```sql
CREATE TABLE public.courses (
  -- ... 기존 필드들
  gpx_data jsonb,  -- V2에서 사용하는 구조화된 데이터
  -- ... 기타 필드들
);

```

## V2의 장점

1. **구조화된 데이터**: `{points: [], stats: {}, bounds: {}}` 형태의 JSONB
2. **타입 안전성**: `CourseV2` 인터페이스로 강타입 지원
3. **성능 향상**: 구조화된 데이터로 쿼리 최적화
4. **확장성**: 통계, 경계값 등 메타데이터 포함

## 해결해야 할 문제

- `courses-data-v2.ts:218` 라인의 `payload.new.gpx_data` 타입 오류
- Supabase realtime payload 타입 정의 부재

## 권장 해결 방안

V2 시스템을 유지하되 다음 타입 오류를 수정:

1. Supabase payload 타입 명시적 정의
2. `gpx_data` 필드 접근 시 타입 가드 추가
3. 필요시 타입 어서션 사용

**V2는 제거 대상이 아닌 핵심 아키텍처로 유지 필요.**
