# 🔧 MAP 페이지 리팩토링 프롬프트

## 📋 현재 컴포넌트 구조 분석

```
page.tsx (서버)
└── MapClientWrapper (클라이언트)
    ├── MapProvider (Context)
    └── OptimizedMapClient (클라이언트)
        ├── useMapState (Hook)
        ├── useMapBounds (Hook)
        ├── MapboxMap (지도)
        ├── CourseMarker (마커)
        └── CategoryFullScreen (바텀시트)
```

---

## 🎯 개선 프롬프트

### **1. 서버 컴포넌트 레이어 개선**

```prompt
MAP 페이지의 서버 컴포넌트(page.tsx)를 개선해주세요:

현재 문제점:
- 에러 처리가 try-catch와 ErrorBoundary 중복
- 데이터 로딩 로직이 단순함

개선 요청:
1. 데이터 로딩 전략 최적화 (ISR, 캐싱 고려)
2. 에러 처리 통합 (try-catch 제거하고 ErrorBoundary만 사용)
3. 메타데이터 추가 (SEO 최적화)
4. 로딩 상태 개선 (스켈레톤 UI 향상)
```

### **2. Context 구조 단순화**

```prompt
MapProvider Context를 단순화하고 성능을 개선해주세요:

현재 문제점:
- MapProvider와 OptimizedMapClient에서 상태 중복 관리
- Context가 단순히 initialCourses만 전달하는 역할
- 상태가 여러 곳에 분산되어 동기화 이슈 발생

개선 요청:
1. Context의 책임 명확화 (전역 상태 vs 로컬 상태 구분)
2. 불필요한 Context 제거 또는 통합
3. 상태 관리 로직 중앙화
4. Context Provider 최적화 (값 변경 시에만 리렌더링)
```

### **3. 커스텀 훅 통합 및 최적화**

```prompt
useMapState와 useMapBounds 훅을 분석하고 최적화해주세요:

현재 문제점:
- 두 훅이 서로 의존적이지만 분리되어 있음
- useMapState에서 너무 많은 책임을 가짐
- 상태 업데이트 로직이 복잡함

개선 요청:
1. 단일 useMap 훅으로 통합 또는 명확한 역할 분담
2. 상태 업데이트 로직 단순화
3. 메모이제이션 최적화
4. 타입 안전성 강화
```

### **4. 마커 컴포넌트 성능 최적화**

```prompt
CourseMarker 컴포넌트의 성능을 개선해주세요:

현재 문제점:
- 매번 HTML string을 생성하여 마커 엘리먼트 생성
- 카테고리 변경 시 모든 마커 재생성
- 클러스터링 로직이 복잡함
- 메모리 누수 가능성 (마커 제거 로직)

개선 요청:
1. 마커 재사용 풀링 시스템 구현
2. 카테고리별 마커 캐싱
3. 클러스터링 알고리즘 최적화
4. 메모리 관리 개선 (WeakMap 활용 검토)
5. Web Worker를 통한 클러스터링 처리 검토
```

### **5. 바텀시트 컴포넌트 아키텍처 개선** ✅ **부분 완료**

```prompt
CategoryFullScreen 컴포넌트를 모듈화하고 개선해주세요:

완료된 개선사항:
✅ 선택된 마커/클러스터에 해당하는 코스만 표시 (2024-11-08)
✅ 동 이름 API 호출 최적화 및 캐싱 구현 (2024-11-08)
✅ 동 이름 로딩 로직 최적화 (useMemo, 중복 호출 방지)
✅ category_name 직접 사용으로 복잡한 category_key 로직 제거

현재 문제점:
- 컴포넌트가 여전히 크고 복잡함 (400라인+)
- 드래그 로직, 카드 레이아웃, 카테고리 관리가 한 곳에 집중

남은 개선 요청:
1. 컴포넌트 분할 (Header, CardStack, DragHandler 등)
2. 커스텀 훅으로 로직 분리 (useCategorySwipe, useCardLayout 등)
3. 카드 레이아웃 로직을 유틸 함수로 분리
```

### **6. 상태 동기화 로직 개선**

```prompt
지도와 바텀시트 간 상태 동기화를 개선해주세요:

현재 문제점:
- currentCategory 상태가 여러 컴포넌트에 분산
- 초기화 시점에 따라 동기화 이슈 발생
- 카테고리 변경 시 복잡한 콜백 체인

개선 요청:
1. 단일 상태 소스 원칙 적용
2. 상태 변경 이벤트 시스템 구현 (EventEmitter 또는 Custom Hook)
3. 상태 동기화 미들웨어 패턴 적용
4. 상태 변경 로그 시스템 (개발 환경)
```

### **7. 에러 처리 및 로딩 상태 통합**

```prompt
에러 처리와 로딩 상태 관리를 체계화해주세요:

현재 문제점:
- 에러 처리가 각 컴포넌트에 분산
- 로딩 상태가 일관성 없음
- 네트워크 에러와 클라이언트 에러 구분 없음

개선 요청:
1. 글로벌 에러 처리 시스템 구현
2. 로딩 상태 중앙 관리
3. 에러 타입별 처리 전략 수립
4. 사용자 친화적 에러 메시지 시스템
5. 재시도 로직 구현
```

### **8. 타입 안전성 및 코드 품질**

```prompt
TypeScript 타입 안전성과 코드 품질을 개선해주세요:

현재 문제점:
- any 타입 사용
- 타입 가드 부족
- 인터페이스 중복 정의
- 컴포넌트 props 검증 부족

개선 요청:
1. 엄격한 타입 정의 (strict mode 활성화)
2. 유니온 타입과 타입 가드 활용
3. 공통 타입 정의 파일 통합
4. Zod를 활용한 런타임 타입 검증
5. 컴포넌트 PropTypes 또는 타입 단언 추가
```

### **9. 성능 모니터링 및 최적화**

```prompt
성능 모니터링과 최적화 시스템을 구현해주세요:

개선 요청:
1. React DevTools Profiler 연동
2. 메모리 사용량 모니터링
3. 렌더링 성능 측정
4. 번들 크기 최적화 (code splitting)
5. 이미지 및 에셋 최적화
6. Service Worker 캐싱 전략
```

### **10. 테스트 가능한 구조로 리팩토링**

```prompt
테스트하기 쉬운 구조로 리팩토링해주세요:

개선 요청:
1. 순수 함수 분리 (유틸리티, 계산 로직)
2. 의존성 주입 패턴 적용
3. Mock 가능한 외부 의존성 분리
4. 컴포넌트 단위 테스트 작성
5. 통합 테스트 시나리오 구성
6. E2E 테스트 환경 구축
```

---

## 🚀 우선순위 제안

1. **HIGH**: Context 구조 단순화 (상태 동기화 이슈 해결)
2. **HIGH**: 바텀시트 컴포넌트 모듈화 (코드 복잡도 해결)
3. **MEDIUM**: 마커 성능 최적화 (사용자 경험 개선)
4. **MEDIUM**: 에러 처리 통합 (안정성 향상)
5. **LOW**: 타입 안전성 개선 (개발 경험 향상)

## 📝 사용법

각 프롬프트를 순차적으로 적용하여 MAP 페이지의 코드 품질과 성능을 체계적으로 개선할 수 있습니다. 

우선순위가 높은 항목부터 시작하여 점진적으로 리팩토링을 진행하는 것을 권장합니다.